incarnation: scafi

variables:
  grid_size: &grid_size
    type: LinearVariable
    parameters: [20, 10, 50, 10]
  range: &range
    type: LinearVariable
    parameters: [1.5, 1.5, 3.5, 1]

  # Derived variable: used for both Bottom-Right X and Top-Left Y
  max_pos: &max_pos
    formula: grid_size - (range / 2)

  neg_max_pos: &bottom
    formula: 0

  seed: &seed
    min: 0
    max: 31
    step: 1
    default: 0

  nodes: &nodes
    formula: (grid_size * grid_size) * 2

  spacing: &spacing
    1
  error: &error
    0.1

launcher:
  parameters:
    batch: [seed, grid_size, range]
    showProgress: true
    autoStart: true

environment:
  type: Continuous2DEnvironment
  parameters: [ ]

seeds:
  scenario: *seed
  simulation: *seed

network-model:
  type: ConnectWithinDistance
  parameters: [*range]

_program: &program
  - time-distribution: 1
    type: Event
    actions:
      - type: RunScafiProgram
        parameters: [ it.unibo.program.LeftRightMachine, 2.0 ]
  - program: send

deployments:
  - type: Grid
    parameters: [0, 0, *grid_size, *grid_size, *spacing, *spacing, *error, *error]
    programs: *program
    contents:
      - molecule: left
        concentration: false
      - molecule: right
        concentration: false
      - molecule: state
        concentration: 0
  # Bottom Left
  - type: Point
    parameters: [*bottom, *bottom]
    programs: *program
    contents:
      - molecule: left
        concentration: true
      - molecule: right
        concentration: false
      - molecule: state
        concentration: 0
  # Top Right (uses max_pos for Y)
  - type: Point
    parameters: [*max_pos, *max_pos]
    programs: *program
    contents:
      - molecule: left
        concentration: false
      - molecule: right
        concentration: true
      - molecule: state
        concentration: 0

export:
  - type: CSVExporter
    parameters:
      fileNameRoot: simulation
      interval: 0.1
      exportPath: data
    data:
      - time
      - molecule: "state"
        aggregators: [mean, min, max]
        value-filter: onlyfinite

terminate:
  type: StableForSteps
  parameters: [ 1, *nodes ]
